DROP TABLE MD_EMAIL;
DROP TABLE MD_EMAIL_LOG;
DROP TABLE MD_EMAIL_STATO;


CREATE TABLE MD_EMAIL_STATO
(
  CODICE VARCHAR2(3) NOT NULL, 
  DESCRIZIONE VARCHAR2(30)NOT NULL,
   CONSTRAINT PK_CODICE PRIMARY KEY (CODICE)
);

INSERT INTO MD_EMAIL_STATO (CODICE, DESCRIZIONE) VALUES ('CRT','CREAZIONE');
INSERT INTO MD_EMAIL_STATO (CODICE, DESCRIZIONE) VALUES ('DIN','DA INVIARE');
INSERT INTO MD_EMAIL_STATO (CODICE, DESCRIZIONE) VALUES ('ERR','ERRORE');
INSERT INTO MD_EMAIL_STATO (CODICE, DESCRIZIONE) VALUES ('INV','INVIATA');
INSERT INTO MD_EMAIL_STATO (CODICE, DESCRIZIONE) VALUES ('RIP','DA RIPROVARE');

CREATE TABLE MD_EMAIL
(
  IDMAIL NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,   
  TENTATIVO NUMBER(1 )NULL,
  RICHIEDENTE VARCHAR2(30) NOT NULL,
  DATACREAZIONE DATE NOT NULL,
  DATAINVIO DATE NULL,
  STATO VARCHAR(3) NOT NULL,
  OGGETTO VARCHAR2(50) NOT NULL,
  CORPO VARCHAR2(4000) NOT NULL,
   CONSTRAINT PK_IDMAIL PRIMARY KEY (IDMAIL),
    FOREIGN KEY (STATO)REFERENCES MD_EMAIL_STATO (CODICE) ENABLE
);

CREATE INDEX IDX_MD_EMAIL_2 ON MD_EMAIL (STATO);

DROP TABLE MD_GRUPPI_DESTINATARI
DROP TABLE MD_GRUPPI_APP
DROP TABLE MD_GRUPPI
CREATE TABLE MD_GRUPPI
(
  IDGRUPPO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY ,   
  NOME VARCHAR2(30) NOT NULL,
  CONSTRAINT PK_IDGRUPPO PRIMARY KEY (IDGRUPPO)
);
CREATE TABLE MD_GRUPPI_DESTINATARI
(
  IDDESTINATARIO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  IDGRUPPO NUMBER ,   
  DESTINATARIO VARCHAR2(100 )NOT NULL,
  CONSTRAINT PK_IDDESTINATARIO PRIMARY KEY (IDDESTINATARIO),
   FOREIGN KEY (IDGRUPPO)REFERENCES MD_GRUPPI (IDGRUPPO) ENABLE
);

CREATE INDEX idx_MD_GRUPPI_DESTINATARI_1 ON MD_GRUPPI_DESTINATARI(IDGRUPPO);

CREATE TABLE MD_GRUPPI_APP
(
  IDAPPLICAZIONE NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  APPLICAZIONE VARCHAR2(50) NOT NULL,
  OPERAZIONE VARCHAR2(50) NOT NULL,
  IDGRUPPO NUMBER,
  A_CC VARCHAR(1) NOT NULL,
   CONSTRAINT PK_IDAPPLICAZIONE PRIMARY KEY (IDAPPLICAZIONE),
   FOREIGN KEY (IDGRUPPO)REFERENCES MD_GRUPPI (IDGRUPPO) ENABLE
)
CREATE INDEX IDX_MD_GRUPPI_APP_1 ON MD_GRUPPI_APP(APPLICAZIONE, OPERAZIONE);

CREATE TABLE MD_EMAIL_DESTINATARI
(
  IDEMAIL_DEST NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  IDMAIL NUMBER NOT NULL,
  IDGRUPPO NUMBER NULL,
  DESTINATARIO VARCHAR2(100) NULL,
  A_CC VARCHAR(1) NOT NULL ,
  CONSTRAINT PK_IDEMAIL_DEST PRIMARY KEY (IDEMAIL_DEST),
  FOREIGN KEY (IDGRUPPO)REFERENCES MD_GRUPPI (IDGRUPPO) ENABLE,
  FOREIGN KEY (IDMAIL)REFERENCES MD_EMAIL (IDMAIL) ENABLE
)

CREATE INDEX IDX_MD_EMAIL_DESTINATARI_1 ON MD_EMAIL_DESTINATARI (IDMAIL);

DROP TABLE MD_ALLEGATI
CREATE TABLE MD_ALLEGATI
(
  IDEMAIL_ALL NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  IDMAIL NUMBER NOT NULL,
  FILECONTENT BLOB NOT NULL,
  FILENAME VARCHAR2(50) NOT NULL,
  CONSTRAINT PK_IDEMAIL_ALL PRIMARY KEY (IDEMAIL_ALL),
    FOREIGN KEY (IDMAIL)REFERENCES MD_EMAIL (IDMAIL) ENABLE
)

CREATE INDEX IDX_MD_ALLEGATI_1 ON MD_ALLEGATI(IDMAIL);

DROP TABLE MD_LOG

CREATE TABLE MD_LOG
(
IDMAIL_LOG NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
IDMAIL NUMBER NOT NULL,
DATAOPERAZIONE DATE NOT NULL,
TIPOOPERAZIONE VARCHAR2(30) NOT NULL,
NOTA VARCHAR2(100) ,
CONSTRAINT PK_IDMAIL_LOG PRIMARY KEY (IDMAIL_LOG),
    FOREIGN KEY (IDMAIL)REFERENCES MD_EMAIL (IDMAIL) ENABLE

)

CREATE INDEX IDX_MD_LOG_1 ON MD_LOG(IDMAIL);
